#!/usr/bin/env python
# Copyright 2014-2018 The PySCF Developers. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import unittest
from functools import reduce
import numpy
from pyscf import gto
from pyscf import scf
from pyscf import ao2mo
from pyscf import fci
from pyscf import lib

h1 = numpy.array((
-3.4767415009793492, -2.5898499924487117e-14, -5.7752176663074986,
0.18821122673778334, 1.313073998490677e-13, -5.6870339186671286,
-7.259389279837676e-15, -8.4737511622947213e-14, 2.908280320904088e-13,
-2.4127499159001684, -5.8094555535857576e-14, 1.2792344811554277e-14,
-9.1601443600731143e-14, 2.6771326639904447e-09, -5.7439945518232651,
-3.3125554955553373e-14, -3.3147859565479071e-14, 1.1049226042735751e-13,
0.56044904748771185, 4.4239564771654093e-10, -5.6440132722683645,
-6.8226161045290202e-14, -3.1070380437817476e-14, 5.5792935313352935e-14,
-8.1431451425667545e-11, 0.10100545993119968, 3.1937262079742568e-12,
-1.7453745356434625, -0.82261599492067916, -4.0047954915408551e-15,
-0.033377230285998344, -3.9378354525405732e-15, 3.1563087959323024e-14,
2.9495392780457552e-15, -3.6221945639370878e-13, -5.5658824139981435,
-0.064216219710363731, -4.0602113685062058e-13, -0.48837423871959068,
1.9615569752261983e-14, 1.1270491656221141e-13, 1.7519055507147385e-15,
-4.8545020445993474e-14, -0.023293552816781776, -2.8619867570866733,
5.9501015226004483e-14, -0.15196306821646724, -8.5575454058031686e-14,
-3.1214213659350871e-14, 3.06040079465527e-14, -1.1126872696106942e-14,
1.8780727551400291e-14, 7.800525633414046e-14, 9.3040251067724733e-13,
-1.6177502405774815))
h1 = lib.unpack_tril(h1)
h2 = numpy.array((
0.35131383941164507, 3.1707153721159675e-16, 0.0022825576145954112,
0.35982436844444393, 1.2195248377356762e-15, 0.89493189734456535,
0.00046600653664421912, -1.0030381519906173e-16, -0.032300693108231505,
0.0072049331405826473, -1.3994339541356648e-16, -0.0010916020506227173,
-1.7383735103531153e-14, 7.5528435011096426e-16, 0.036496418011134964,
0.34542768762369064, 1.0681769559786921e-15, 0.80542364180897241,
-0.032533068275673697, -1.7152243023984693e-14, 0.86657797497497224,
7.8674663198634222e-16, -9.7385737807896411e-17, 3.7750330271094681e-15,
4.3073079175245746e-16, 5.3261329485242098e-16, 3.621774808882302e-15,
0.0086994767998390815, 1.633282447582614e-15, 9.7090325432627523e-17,
9.37460867236528e-15, -5.8896231094443827e-16, -3.6352579478471002e-15,
9.3896002273573169e-15, -8.9526417217642741e-13, 0.00089166439272470564,
-1.0864054704479313e-14, -1.386250769180112e-17, -5.7234020169252841e-14,
2.722170738215054e-15, 5.0359152405007837e-19, -6.3523671911657384e-14,
0.00019504158573670165, -2.2123696164224391e-12, 0.0005564185904738709,
0.23648942856895794, -1.0824594604300438e-14, 0.23843795351661523,
-0.0062182941567863288, 3.9116947353638729e-12, 0.23564144655928376,
-6.9252398573611858e-16, -4.0559263496618762e-16, 1.9492019901982572e-15,
0.25797448879956292, 8.1141467328863534e-18, 4.1932828313772597e-17,
1.4213674849494406e-14, -1.4293300807331674e-15, -8.4520795575288804e-17,
1.1423949739615914e-14, 4.1929231305588545e-12, -0.00069123358519366422,
3.7540004706845307e-12, 2.0341350774484981e-15, 0.0034891875343815099,
-2.8196398726879687e-16, 5.6515413148196965e-16, 1.1215595843144376e-17,
3.4207638885099677e-16, -7.4042354698602651e-16, 5.6713020312813126e-16,
0.0018047635438059829, -2.6743485497393181e-11, 0.00080809296814091873,
-3.9598443257744639e-16, 8.9387984934301032e-13, 0.034166238037026148,
1.5860198117880035e-15, -1.0721189447913802e-16, 5.2853164461068944e-15,
1.6638940068347082e-15, -2.1044170061436001e-16, 3.2278288647527296e-15,
3.7494140238223341e-12, 0.001945539847458334, -2.2824078126543557e-11,
-1.0787689712876992e-15, -0.0044765040856033578, 2.1979527431112579e-12,
0.028956361900271517, -9.239703491518373e-11, 7.6600640998433018e-06,
-4.7017949074607858e-10, 1.3939489350633501e-11, -0.0024367963546087119,
-4.6989866142442159e-10, -8.7624250028126669e-17, 3.6802884533805737e-17,
6.2798164581189828e-17, 1.8954645419558139e-11, 4.7890754077448912e-16,
1.003713938202677e-15, -2.7998733186340113e-15, 0.00083466314036259256,
0.35146826559452526, 1.2558384059362414e-14, 0.82345077909192277,
-0.023554763031375391, -3.905267249063285e-12, 0.8203006500584501,
2.842467257314758e-15, 7.1748472125065778e-15, -5.9226494710078607e-14,
0.23269021857998984, 1.47547205678703e-14, 4.1479221707859137e-17,
2.8610808504624155e-15, -5.2593028679076537e-10, 0.88874129155964987,
2.9991037531845211e-17, -3.6526783903339952e-17, 6.7900854549517719e-16,
-5.5883447053790434e-17, -1.4333665081471341e-15, 9.5590281561881809e-16,
-7.8870468414513715e-05, 3.8507765871258974e-12, -0.00012140398476236408,
-9.7630982407264893e-17, -6.0360538931380579e-14, -0.0047917004181168479,
-9.4333091282931836e-14, -6.8050473200956747e-17, 1.1264151839894163e-15,
0.0033203894267665392, 2.385987182102882e-16, 1.6422532763471214e-16,
1.3061727955601064e-15, 1.1381665281570039e-15, -3.8469132424003586e-16,
-6.9459137169252823e-15, -3.1967774239381741e-12, -0.0049673221615937815,
1.0135119165093007e-11, -2.8066992485865402e-16, 0.0039825526313201883,
-3.9953125870267846e-12, -0.012613649014578742, 1.2357482268707215e-15,
9.3446471603869747e-15, 2.3062119468080736e-15, 0.033493857911548429,
-1.5422049891084676e-15, -2.1991364523420197e-17, -8.1278833892844464e-15,
3.4810698407870996e-16, 3.8659587262034851e-15, -8.7578330002263187e-15,
-0.00043455256825471482, 3.690006167159223e-12, -0.0029227511097871775,
1.4063794688219018e-15, -3.4320220180611257e-13, -0.0045951412538124473,
-2.3630713149055405e-12, -6.9785347683584632e-16, -7.8835823890760961e-15,
0.00053340895162692437, 1.8164845246667162e-14, 0.019514897617630058,
-0.018922483500506605, -9.857361686425673e-15, -0.089099875131647396,
0.0042047784271068899, -1.3202062622766788e-11, -0.091872901746626101,
-6.5145714403028007e-16, -1.4475318981015438e-15, 1.0104165458837675e-14,
0.0055849479169134721, -1.8624304392520042e-15, 3.3582180613813245e-16,
6.2298981650820998e-16, 8.0388951258315259e-11, -0.089552693066643541,
-2.1533343320907945e-16, 2.4331374435622631e-16, -3.1434597859282144e-16,
0.017457653372904169, -1.524671994034807e-11, 1.2908030158400932e-05,
-7.172416800954785e-11, 3.3749560377299325e-12, 0.016434042566915594,
-7.3931094555762641e-11, 8.3373299170764291e-17, -1.6760047875606699e-15,
-3.9281474004130565e-16, 1.2323263869312533e-11, -4.702207760678696e-18,
-3.7649270332920617e-15, -4.9773315315230605e-16, -0.0048929043645304753,
-7.9958417775857944e-11, 6.3214280440911532e-17, -5.8538785386422955e-17,
4.4792865689861284e-15, -1.2803276882816523e-11, 0.033402238468340513,
0.34521636972587327, 1.52340298976084e-15, 0.81072029139909363,
-0.033756841077667951, -5.1290149382172785e-14, 0.82481838106565186,
3.5884519322959661e-15, 8.1142209828263215e-15, -5.8800892904085971e-14,
0.24215667529663806, 1.4632204271598856e-14, 1.4895701504925118e-16,
-5.9516385809064154e-15, -4.5472561049920637e-10, 0.80793685114200042,
9.7656657269972483e-16, 1.2575626638435045e-15, -8.5628324861485333e-15,
-0.095694392290374922, -7.7029813338880497e-11, 0.86123786787695511,
7.4034799575905543e-16, 1.1518083790979749e-16, 1.4188378107642675e-14,
-1.3069711826429012e-16, 1.4587858717872078e-17, 1.2876721156060244e-14,
-1.5181385845436293e-12, -0.00022413225392775454, 2.7106765953965775e-13,
-1.0375902744300012e-15, 0.0019024584040618049, -1.7905489357238026e-13,
-0.00033152823038334856, 6.7573134601579325e-17, 1.3764055460509027e-14,
1.2076119241670084e-14, 0.00066768923828740051, 3.6832366914120603e-15,
-2.3148445223312235e-15, 2.6688499014362753e-17, 1.312638997737486e-14,
0.011288595194976152, -3.0592899897793387e-16, 4.9077792771739137e-16,
7.1143958427267622e-16, -1.1914503066011786e-17, 1.9086903580375392e-17,
1.0774122725836063e-15, -0.00021292983470447738, 8.0442880945499484e-13,
-6.9914217608312725e-05, -1.6132082164479745e-16, -1.7429689478480072e-13,
-0.00099600907267141637, -4.378895824797173e-14, -2.1112809924204656e-17,
1.1324265798307491e-15, 0.00019510675740438748, -3.2101052205478421e-14,
0.00024108961325209642, -9.8153143194084349e-17, 2.6884104841069614e-16,
1.0394477565015324e-15, 3.4221803959144561e-16, 9.5763546424948892e-05,
-1.8225763203557049e-15, 3.8231873334844651e-17, -8.2387239811395308e-15,
1.7045713744923445e-15, -1.4218676666073965e-16, -8.7063623965956929e-15,
-5.054355801605595e-13, -0.00018727611653050183, 1.0193666230611521e-12,
-1.2193412428067487e-15, 0.00063942068115422496, -1.4526694528865439e-13,
-0.0012649677327387203, 1.8803631160754565e-16, -5.312908273219728e-15,
1.8508822656408116e-15, 0.00074739681548258456, -1.7784139118522167e-14,
1.209030039306186e-15, -7.0478549811504697e-17, -8.3822852440044615e-15,
0.0017764486820596684, -6.0890384840539991e-16, 0.00046258303235138397,
2.8230442072549322e-12, 0.00014013900029128081, 1.368351590889938e-11,
-8.7721223353311455e-13, 0.00017298706213868671, 1.446150778338165e-11,
-1.963218196290934e-16, 3.8442195887414113e-17, 5.2985646083582933e-17,
1.9644077488799316e-12, -6.3414757907780652e-17, 2.3208893964086766e-16,
1.869683840650353e-16, 4.602906866321713e-05, 1.538712012623053e-11,
-2.3642626131025335e-16, -1.0543398453332507e-16, 2.3702570452155856e-17,
-2.432801981310591e-12, 0.00038403986238833796, 1.3970990705471087e-11,
1.617665836225297e-17, -5.7361921522128474e-17, 1.343758438630937e-16,
0.001943002204285579, -0.0034349883883615547, 1.1237863762005468e-13,
-0.016981752644306573, 0.001135509833228105, 1.2231918482404342e-13,
-0.017953625069281637, -1.278065600922536e-17, -2.9236719866388387e-16,
1.5644226024788607e-15, -0.0027931513943076423, 5.0078854806784121e-17,
-3.2559819970800869e-17, -9.9749624697824841e-16, 1.3059432609415791e-11,
-0.018991245443291969, -2.9791173171425565e-17, 9.0469362323164586e-16,
2.1461027409422631e-16, 0.0025910439586777621, 2.3600203023321009e-12,
-0.017362421412469003, -1.078538098133757e-15, 6.2621393879045629e-17,
1.6755436090949318e-16, 7.7350628371398896e-13, 0.00098371178076836767,
-7.4953010378159268e-14, 3.5998190339197959e-05, -5.768354001921272e-13,
4.4672571001267477e-14, -0.00044440055110525617, -5.9538997538612082e-13,
-4.6358453831660751e-16, 5.2812363204879964e-17, -1.7741668422494258e-17,
-5.0580476222347737e-13, -2.4086323271810756e-19, -1.5573831345585299e-15,
8.7704222120404549e-18, 0.00025495945149267172, -1.6373070976273552e-13,
1.0220086893389847e-15, -6.9847879889997553e-17, 1.1284540557414558e-16,
8.9725764410075791e-13, -0.0010215278649183491, -6.3613482157668516e-13,
2.000528965844569e-17, 6.9113352519840742e-17, 7.2517330969597991e-17,
0.00034975076762246106, 2.9847086528023859e-13, 0.00017596898366849107,
0.2437748384821285, -3.1833655974249737e-15, 0.21187085117759472,
0.0074094104881699202, -4.8240430052681358e-15, 0.2079255577509774,
4.9282206298874628e-16, 5.2316647699327147e-16, -3.8036377488624997e-15,
0.16951766424291678, -2.6670732508734607e-15, -2.4972832737909378e-18,
1.1878561473611473e-15, -3.434127062422583e-11, 0.21226636392748496,
-2.3618530453816292e-17, 2.7856823841324063e-17, -4.7762057969004092e-16,
-0.0067984161636957877, -5.4905005323187478e-12, 0.20564069358743639,
-5.6408864833544552e-16, 3.1858168316889797e-17, 3.6796444237075333e-16,
-1.1419422282370239e-12, 0.0015788404963774873, 4.9804006710017171e-14,
0.24055157427723084, 0.0051595060173098206, 2.6231435118251366e-16,
0.14518805173310773, -0.009682889944557356, -2.9093767499491316e-15,
0.13407515693850489, 8.4634699311769484e-16, 2.1163364654918842e-15,
-1.3555737363575706e-14, 0.0002349933636685012, 4.0567161660908219e-15,
-1.4614006606977847e-16, 1.7328731987941304e-15, -1.1208906613778656e-10,
0.1396996069939348, 2.8887302190562072e-16, 3.1146623201555169e-16,
-1.9288548923336218e-15, -0.021287687265312771, -1.7131579963291719e-11,
0.1347754507697938, 3.2659027649451808e-15, 8.5181771178774131e-17,
-2.1764892496328422e-15, 3.5541013881245807e-12, -0.004442675387847623,
-1.4499208256787478e-13, -0.012067283190602799, 0.046106715251857326,
6.4891088210033542e-16, 0.0050119100189891189, 3.2796260214409782e-15,
-9.8567572357735785e-16, 0.005525587376355833, 4.0215531913693342e-15,
1.1327877869083041e-16, -6.0436530963885647e-16, -1.5098177119543002e-16,
1.170169270014391e-12, 8.7721973258567082e-17, -1.7731814492810102e-15,
-4.3102826261790546e-16, -0.00072890590087752597, -1.1625577180244325e-12,
5.0136126200183367e-17, 3.9798815536270668e-16, 1.592285811710087e-15,
-3.9714667749808565e-12, 0.0049422082627725277, -5.6445745680038949e-15,
-1.4485061472220858e-17, 1.9166368024142706e-15, -4.0653778275949044e-18,
1.9015630137580187e-05, 1.0188103661253755e-14, -0.0001374870107426815,
-1.0003302405978045e-15, 8.3499427973321178e-16, 0.019827501812455638,
-0.0038939057270991097, -6.8856449129802908e-16, -0.0080085704994003037,
0.0099803106254081602, -2.4424819390004105e-16, 0.0030314663131429495,
-1.2145572068777846e-15, -6.5122376320792898e-16, -3.5983841980291724e-16,
-0.0015372954705628375, -5.0755987176162504e-16, 8.0504220179989971e-16,
2.8400787474191808e-15, -1.8591775517660983e-11, 0.021600295621906022,
-1.605813148454315e-16, 3.8539039199541939e-15, -6.6986134021137137e-17,
0.00056077847142753151, 4.2435984699502564e-13, -0.0065048281794581955,
-2.7913493783208279e-16, -2.4726932333149984e-18, 3.3858142788332381e-15,
6.0491400600999341e-13, -0.00075598536515432109, 5.3418118789609262e-15,
-0.0017817725459601847, -0.00050656558395597575, -2.8194927171681636e-15,
0.036641980634480341, 2.7846753018570133e-16, 1.0978962542700286e-16,
1.4017318021110701e-15, -1.3300892587625204e-15, 7.8104241729114042e-16,
2.4263099626063964e-16, -0.0021150122565733232, -3.511632370018601e-13,
0.00012247886149952108, 4.9201390981938967e-16, -8.1808448267335865e-12,
0.002199025538616721, 8.1263867316041545e-12, -8.5242941202928864e-18,
-1.8388112540172889e-15, -0.0018134366358137013, -9.7253644404864078e-12,
-0.00072031720618448815, -8.2967535547613042e-18, 2.8202824584695375e-16,
1.251501881880002e-15, -1.7140690399850606e-13, -6.7974235777804124e-05,
-3.8944432540468486e-13, -2.3462673351017403e-18, 3.5371592712359962e-17,
-4.9534995677223811e-16, -2.03535771163402e-16, 2.5899071316311264e-16,
2.7040229077142476e-16, -3.5806808286508817e-15, 0.0015566761619728291,
1.7985546749172126e-15, 9.3256277931927948e-17, 3.494834581083812e-15,
-7.5824763114695443e-16, -4.3485525750355031e-16, -6.5264935873844049e-15,
-8.1759249215925944e-12, -0.001761974501153344, 8.1252467305777149e-12,
8.1857916498919648e-16, 0.008062331541206039, 3.4903756003946453e-13,
-0.0099897212405255023, 1.0360985741255622e-15, 3.9629023996520634e-16,
-1.4557080767362446e-12, 0.012098440171782474, -5.6345035910403281e-13,
-1.1842817263939001e-16, -3.5135164400067661e-16, 2.9841039302583959e-15,
0.00020699809034640143, -6.6299204466531933e-14, 0.0004823051472068655,
-6.7295096460477555e-17, 2.7969658095767735e-15, 9.8804436358612903e-18,
4.4691115619489431e-16, 4.9552652852317036e-16, 2.1795053776493886e-16,
-2.8318241441563499e-15, -2.1200483278087358e-11, 0.02793190326377485,
1.3606678942291366e-16, -7.2825360189642804e-17, -7.8353801289876088e-16,
-2.9958751373632323e-16, -5.3173342299069799e-15, -3.3491296392307849e-17,
-0.003228549407003004, 1.3277533599836816e-11, -0.00084694119923745372,
3.0732495344532563e-16, -2.5939705817399868e-12, -0.016520390501914284,
-6.6792586920998936e-13, 2.8983339223236111e-17, 6.4695244818169922e-16,
0.0098791111214736032, 3.7407926558650161e-15, 0.0049535780370964892,
-3.5801374656513824e-16, -1.5577274204718179e-15, 1.9962694652589272e-17,
-9.5774138629042234e-15, 0.00053974735250220454, -6.4990647018835903e-15,
-5.7291590488194134e-16, -3.7488541519520027e-17, 3.5698109060874702e-15,
6.9818414615148619e-17, 3.2813423945691736e-17, 4.9702889603433654e-17,
-4.4158018807594048e-16, -0.004663079462699859, -3.7452756939808102e-12,
0.035812609200555123, 1.2075742854042163e-14, -8.4853147139049372e-17,
6.154997227365964e-14, -3.8531046180093002e-15, 8.4100687923832877e-18,
5.7112182979282797e-14, 7.2183933592730762e-13, 0.00011135510333675692,
-2.9207700363332297e-13, 7.4653085202126336e-15, -0.00090445022338658159,
1.0636926654853944e-13, 0.00036201870972559554, -4.7526614506371914e-17,
5.9234223374566071e-14, -1.4882627744467672e-14, -0.00045953870018004193,
-6.4220140243798059e-15, -7.5940262758654127e-15, -1.0725139200081697e-17,
5.726951748831526e-14, -0.0045707193263868039, -2.5359416022542044e-16,
-0.0007379448889297481, -7.1257474902912482e-18, -1.5585973365857643e-15,
2.1514500564220986e-19, -2.5514258385752999e-15, 1.6199197233583534e-14,
-7.7811651602269461e-17, 1.3083579342191249e-16, 5.1276334003487826e-13,
-0.00062830642388710209, -3.4542527875954939e-14, 0.0019173809947478555,
0.36630876799234252, 6.672503233135833e-16, 0.83703301128729901,
-0.026657447506003944, -1.1525036403343104e-14, 0.78682808437862184,
3.2947516232411552e-15, 8.5528336224565585e-15, -5.5450487891528174e-14,
0.23734265157215462, 1.2439615422080633e-14, -3.9790534519539536e-16,
9.5435438772266354e-15, -4.6663754686337185e-10, 0.81795025053248616,
8.5176178067077497e-16, 1.1461790920190433e-15, -7.5425143663569839e-15,
-0.08479540740035206, -6.8275369590825131e-11, 0.7871026886915331,
1.534166598410978e-14, 1.200530694245626e-15, -6.6787252708998572e-15,
1.2877941209265249e-11, -0.015953031502663511, -5.4770862416278852e-13,
0.21898202206711198, 0.14649374004850407, 3.4399398842566308e-15,
0.0018160574844325818, 2.2989635144123395e-16, 2.1439599866273931e-16,
-7.3983474482263336e-19, 6.2767818034513241e-14, 0.86203180106750033,
-0.004691171592468131, -2.0277304365799948e-15, 0.0017952078652132566,
-0.00562569339566005, -3.8982475876826511e-16, 0.0010112542310624177,
-4.5999593080712917e-16, -4.1290941428521456e-16, 2.6846607100391192e-15,
0.028594852822716586, 1.9416350196172094e-15, 2.7947430017432603e-17,
3.6042634099033696e-16, 2.1385007424856852e-11, 0.0019674299337318012,
-5.0644667968136364e-17, -6.8226948092955455e-17, 6.1632578434662711e-16,
0.0061166440369100246, 4.9105840970030699e-12, 0.0029287966712461364,
-5.8346701646525227e-16, -4.4614974421730472e-17, -1.5311864012196215e-16,
9.5278490740744995e-13, -0.0013801809624633373, -5.2588764022151645e-14,
-0.024591637743805777, 0.0030043743357993364, 4.4727636983745393e-16,
0.002845443033866068, 7.270989541475052e-17, -7.8837669164537236e-16,
-4.799209382742659e-17, 2.9249597265533233e-15, 0.00011386141469946548,
0.03333666803072393, 9.6607732935367202e-15, 0.00027631239094167055,
8.702243027743084e-14, -4.2320943477168233e-15, 0.008252630533314544,
7.5865529136631693e-14, -5.9158013563771433e-17, -7.397421746086795e-16,
-3.1558915801762984e-16, 2.1999152309938944e-12, 3.070520458367754e-17,
-2.6648212228246281e-15, -1.7511139241056422e-16, -0.0013733961874256824,
-2.1206571993782376e-12, 1.5872375159655047e-17, -7.9078173575988295e-17,
1.6280273656042334e-15, -4.0469605841321021e-12, 0.0050259015856151815,
6.5979272284404089e-14, 8.066934823081803e-17, -1.8077463687836288e-17,
-2.6240782513218405e-16, 0.00037698389366880064, 2.9770832083868314e-13,
-0.00058128631895022309, -1.0968493908275478e-14, 2.0255111573186293e-14,
0.0019518837178504559, -1.4345858743862775e-15, 1.5286465513954022e-17,
-1.3362831577727387e-16, 5.6365073501611235e-17, -6.6103980069265712e-17,
8.0881644697744504e-14, -9.24966754665274e-16, 0.008532091294393012,
0.014110599281970579, -8.7465627985103917e-17, 0.088828742854645412,
-0.0056548850035874976, 3.0243212649436879e-15, 0.09560094526004019,
7.2952025309583071e-16, 1.010791771204211e-15, -8.912378232123796e-15,
0.006465451437456967, 2.8662578264363048e-15, -1.0187918351795876e-16,
-9.1342308467825677e-16, -6.6903889580592139e-11, 0.089700942919721499,
2.7377367278302967e-16, 7.6797627411195022e-18, -1.0735340156118557e-15,
-0.011794974766433725, -9.488241636186157e-12, 0.090933533111604001,
2.3943208702781568e-15, 6.889732070877154e-17, -5.7249321687162838e-16,
1.1801501627608512e-12, -0.001469961177906696, -9.4556968721570937e-14,
0.00024892701485531383, 0.021473790476718074, 1.3986523933610747e-15,
0.00078372547667518932, -1.0964122559506877e-16, -5.0773301503459019e-16,
9.6604870489448014e-17, 8.2270023915627068e-15, 0.085188961218720424,
0.0014555704228068846, 1.2317045216841038e-14, 0.023642263684997986,
-1.6549503561381643e-15, -2.0088797449051472e-17, -7.2618538356564036e-15,
6.3159723673813998e-16, -3.7994767060582005e-16, -7.8818451405921909e-15,
0.0019429035824971191, 1.7199275997122883e-12, -0.00050342099458280303,
-5.6252332209112995e-16, 5.4553736942621855e-13, -0.0015917228502290764,
-3.0732885368668491e-12, 1.1369920740143153e-16, -7.1319509635130146e-15,
0.0014399815514223773, 4.6973419617509853e-13, 0.00050126348272564651,
8.0868982766211039e-16, -8.2126382679257228e-17, -7.37987298779251e-15,
-6.0962795601382129e-13, 0.00028589134872255932, -5.4222270999634768e-13,
-2.2730110613052451e-16, 1.2088605688467429e-17, 2.4561097885131516e-16,
-2.8748433483768092e-16, -1.507181043658104e-15, 2.2276380501834444e-17,
-1.5157745553988615e-16, -0.0014831343254690283, -5.1633677003852985e-13,
0.00109826072921904, 2.8720485255140003e-13, -6.9973610276910873e-15,
-9.4869278764803944e-17, 6.6114952739300659e-17, -1.6047066558600718e-15,
0.0052632102396085265, -4.8784710988172675e-15, 3.4705517570915102e-17,
-2.9546026268674886e-14, 2.3597910249424666e-15, -2.9185431371709692e-16,
-2.9641898953317312e-14, 5.522391688754045e-13, -0.00055246020626963847,
-3.0703982776041974e-12, -2.5865022224226267e-15, 0.0012657123219753112,
-1.7168853227186739e-12, 0.0033148863532485831, -1.5521173481239218e-16,
-3.2045054395234504e-14, 1.155811990205831e-12, -0.00057664611400276935,
4.004642562786253e-13, 3.8697829580545836e-15, -2.8350273742618498e-16,
-3.02745686097432e-14, 0.00072901221540973835, 2.3274412850384219e-13,
0.00067435942949513469, -1.5958652792968845e-16, 1.2328430107917739e-16,
-6.5376493568447685e-17, 7.1405631010813339e-17, -7.2064751095214868e-15,
-1.0407104113073411e-16, -6.2798054918035163e-16, -5.2015076286190242e-13,
-0.00083427236843058275, 8.8004377297123424e-13, -0.00034516986600889262,
-2.82374519570425e-14, -6.8756915228059422e-16, -2.5542136232768543e-17,
-5.2645490231496259e-15, -1.7484250598616481e-12, 0.0074410584441336495,
-5.6439693763094166e-16, -4.2062748859124051e-17, -2.8955102155060759e-15,
4.5600440925868503e-16, 1.9309161661765568e-16, -2.9901813167912737e-15,
0.0030610670151533497, -5.2318627815031755e-13, 0.00010205530505318761,
-4.0763058111039915e-16, 2.4560000085137323e-12, 0.00065452655929508247,
7.8436703358877071e-14, -3.4291708584249032e-17, -2.9777571062294399e-15,
-0.0008026051397671723, 5.3363153034951807e-15, 0.0020748835525941831,
2.6578014176375979e-16, -7.0751303418058787e-16, -3.1405243531568107e-15,
-1.9513259180385312e-14, -0.00049905701439352816, -4.8145662451442996e-15,
1.2749832682249929e-16, 6.2316454462564675e-19, -1.9803296103787367e-16,
-2.1478036563244625e-16, -6.5895517719742337e-16, 4.8662786909347721e-17,
1.2031027279429286e-17, -0.0002375459420741703, -1.8749492175893395e-13,
0.0003774006514418176, 3.1947949058042128e-15, -2.8447070871420364e-15,
-2.7852342483737727e-17, -1.6602336796247658e-17, -7.3902209353063222e-16,
-0.0023001792159510637, -1.8493883920724766e-12, 0.0086868168344887836,
-2.39180865454265e-15, -2.6031486877540704e-17, -4.882726699106459e-15,
7.1575159939501464e-16, -2.693860294528691e-16, -4.0823811237039296e-15,
1.0661532272566272e-12, 0.00044901550214405359, -9.6695409305149583e-13,
-4.6444207439057723e-15, -0.0013755515550367926, 3.6451090459501632e-13,
0.0012026365387612988, -1.733355806701316e-16, -4.75643710471365e-15,
-1.2961053366363547e-14, -0.0013352608684447397, -7.3133256652739391e-15,
2.5993574906028129e-16, -1.4105641970849915e-16, -5.3083109145639527e-15,
-0.0059067897690221549, 2.2067590556138677e-17, -0.0012431996711639176,
1.1921806675330563e-16, 8.8260502813892415e-16, -6.2441198586162135e-17,
2.8204419038813789e-15, -4.3791303773514671e-16, -8.2013768688569663e-17,
4.6613284703683415e-16, 5.3427807655385769e-13, -0.000646126553331361,
-6.9500577981520401e-16, 0.0024867721480722016, -4.376375220341604e-15,
-3.1473258529105037e-15, -6.8616863140781548e-17, -7.4766388083189652e-16,
1.2663145991935226e-12, -0.0015871039149721569, -3.5896155161805818e-16,
0.0040164286128280277, 0.0062266646576009544, 1.1142273464135216e-15,
0.009154640466749327, 0.0055325521893756077, 3.5000060478059772e-16,
0.0096970153129261848, 9.1054853249783223e-17, 3.1431559881554152e-16,
-2.3912009175814504e-15, -0.014988015225607032, -1.6208495666921774e-15,
2.379137421897644e-16, 1.598116675727826e-15, -2.4151457189509996e-11,
0.01507660356266341, -3.1893668813816959e-17, 1.6669890439605108e-16,
-3.7057921390040845e-16, -0.0033342817688888429, -2.6855677175187965e-12,
0.0066110703612670355, 1.0099687146650293e-15, 1.1498133133416685e-16,
8.5162875650369069e-16, -3.153485057879946e-13, 0.0004998023584536366,
1.6430112269693839e-14, 0.014340480036652311, 0.00082538267903183927,
2.6078902748598792e-15, 0.0054811950307963025, -6.3502761217695004e-16,
-1.7890016942132333e-15, -2.0758919905869447e-16, -7.135250209860424e-16,
0.012823168194061657, -0.013774460953287826, 1.5386091436056309e-15,
0.001797515066554853, -1.9861162005015821e-16, -3.0506111172749457e-16,
-8.1569126106548858e-17, 1.9164824920495942e-15, 0.012800785481814103,
0.31149438864543277, 2.5310789052180257e-16, 0.39093820171686572,
-0.0092363439613843048, -1.8326227234572915e-15, 0.39173356470124276,
8.7238160298243893e-16, 2.0106947561542813e-15, -1.4879049460566774e-14,
0.24464144355447165, 3.5669122299076274e-15, -1.4031377470954994e-17,
-1.088254745753474e-15, -1.1597225725241299e-10, 0.38893680693650839,
1.2830486165811494e-16, 1.7371447304460248e-16, -2.2235375296393047e-15,
-0.025386607871324494, -2.0445340229493186e-11, 0.39023673924028668,
1.3946427808914397e-15, -4.0428896041007105e-16, -3.0281847206714411e-15,
6.1034582345640486e-12, -0.0076808746243071874, -1.7046606538165646e-13,
0.20487313981124811, 0.025472866262082207, 6.0716988593558665e-16,
0.00069570448763396143, 1.2376702462174751e-16, 4.1522118843139649e-16,
-5.1879734442081073e-17, 1.8587418273436656e-14, 0.38506355617720633,
0.01667975499748587, 1.5006666521344652e-14, 0.019949726779525445,
-1.72672976622734e-15, -7.2354164050865382e-15, -6.5616089085660792e-16,
-5.3017775843797309e-15, -0.0071915753132302937, 0.32192548110831226,
1.1874724294147487e-15, -0.0019327401672596461, -8.8476589336222711e-15,
4.8171228354245744e-15, -6.0239350704345586e-05, -6.9066388892757846e-15,
3.7181228594484548e-17, -1.1481043138956737e-18, -4.3668943475087437e-17,
2.6739987177629154e-13, 5.4602328016130215e-17, 6.9235266506065094e-17,
-2.2050355406269578e-17, -0.00019581681452991942, -3.2288348427236824e-13,
5.9022802464388575e-18, 4.6926471177057247e-18, -2.3144112224718249e-17,
4.1561667696051569e-14, -6.5462268688998952e-05, -9.914432556185071e-15,
-1.4275211166063466e-16, 7.5312011687702991e-17, -1.276024832413088e-16,
-0.001179455551726809, -9.4427802981319168e-13, -0.00035886032433912708,
4.4174380950043335e-14, -3.994579427164021e-15, 0.00037324013172178333,
-1.9833809826018417e-15, 1.069900245775643e-16, -7.9341435609817856e-18,
6.9585084591091532e-18, -1.6010563963890628e-17, -7.5368314020329841e-15,
-2.2637802548318431e-14, -2.119906830187576e-05, -1.1121781884256563e-15,
-1.6120421949633304e-16, 6.0374703794452326e-19, -1.5995346088098232e-17,
-3.6078523185399599e-18, 8.5520715136150528e-15, -1.8268887921543686e-14,
0.014572714716048199, 0.0051646222003066712, -5.0898834487309507e-16,
0.031013739056354499, -0.0015455409220520952, -1.4599183799073875e-15,
0.026967525212911122, 1.8003555466150336e-16, 4.4040048203691023e-16,
-2.6096677338929072e-15, 0.0011046711944207581, 6.8547375633419077e-16,
-1.7306099136701968e-17, 3.1507910480062364e-16, -2.1593440945636749e-11,
0.027974579959253586, 3.9994694145950079e-17, 3.8816592009803866e-17,
-4.1425805419794673e-16, -0.0044164307963995651, -3.5554233422809651e-12,
0.027182705234642744, 7.7693498990192622e-16, -2.0883005737075544e-16,
-4.3275807015550875e-16, 8.1465581503581798e-13, -0.0010140178212027793,
-2.4068012597559633e-14, 0.00025842183850802029, 0.0075766659103396854,
-9.9863029841222432e-16, -4.8111111119104993e-05, 3.7572206135390593e-17,
6.5055414866412017e-17, -4.0071102901053127e-17, 2.6986160616871384e-15,
0.027339201797167999, -0.00027091436679330257, -5.19605818163633e-15,
0.0037928424122286842, -2.8062516712655041e-16, -1.2565924951463959e-15,
-9.4537389969628059e-17, -2.6445934800577455e-16, 0.00043226247815746457,
0.0087360228903280261, -2.2022856628611809e-18, 0.0020192461187972317,
4.7202096831872042e-16, -0.00019252764472404765, 2.0183185770470194e-14,
-3.332718628910029e-16, 0.0014737528897395805, 2.1254802727425394e-14,
5.7167453036959995e-17, -1.7107720859286709e-16, 4.9870152342423519e-17,
4.9163323694208227e-14, -5.5165178680685129e-18, 1.9068078912786845e-16,
-2.5022102852179215e-17, -3.081769560595964e-05, -2.9349315539732926e-14,
-1.0024147060455341e-16, -1.1795927199397594e-17, -1.3801811989138885e-17,
-3.5775939264318966e-13, 0.00044178399076805761, 1.9614193082218012e-14,
-3.9955055426172943e-17, -1.8879241561344084e-17, -4.577335409982026e-17,
-0.00012556334726132173, -1.012261851095294e-13, -1.94242101287887e-05,
7.7198718338028494e-15, 3.3930379428140412e-15, 0.00022665519382067021,
-2.3788299971264835e-15, 6.4206284481806888e-17, -1.0069698141611948e-17,
-3.1941685195947344e-16, 8.7224185752910913e-18, 2.191477522454216e-14,
-5.3133529748315006e-16, 0.00041165987182713971, 1.8962850844982142e-16,
-1.1990749660752443e-16, -1.1384496181423382e-17, 2.0994707182993977e-16,
-5.4431462073294924e-17, 2.1694599068419653e-15, -1.3107800977442408e-15,
0.0010745997182245459, -1.6929089666166595e-16, 0.00038906540629101398,
2.7885879971501826e-16, 8.5680199720716142e-18, 6.3015287252526492e-16,
-2.3145956819270427e-17, -1.8268757242441658e-16, 6.8439968154577757e-16,
1.5341569690282728e-14, -0.00013319736992543779, -2.5625081813105091e-13,
-1.6189837063909727e-16, -0.00016880638844233751, -1.7653197225221831e-12,
0.00020973385497941567, -3.6731714938955654e-18, 4.4765351082398045e-16,
2.7053976325549746e-13, -0.00033115593904559483, 3.5719085122497502e-13,
-1.3919628188330084e-16, -5.320342461368819e-17, 5.3968558823577718e-16,
-0.00029559254806404007, 1.1517913793286893e-13, -6.54426634334156e-05,
1.9240844865511629e-17, 2.3694646189746235e-18, 1.6022679552041863e-17,
2.2351081591034411e-16, 1.2417068688931812e-16, -3.0894372877228099e-17,
-4.227436144231932e-17, -4.4376347062470177e-14, -0.00011164281303511281,
8.000074302162721e-13, 0.00013219520955490895, 5.695139332576541e-16,
-2.9862298651985848e-16, -7.0382615405343401e-17, 1.1880303453576248e-17,
4.1416398782152466e-13, -0.0001469078056116088, -5.5509473303987942e-13,
6.5110831110581173e-05, 1.4211776284120097e-16, 1.1175196117520705e-16,
-9.1336784538970836e-17, -1.7030219265776572e-17, 3.0741774206770643e-16,
0.0031668610291794887, 5.2024391244172885e-17, 9.4334967013513623e-17,
-3.9201752673309828e-16, 4.6281117696649224e-17, 1.7518119724290298e-16,
-3.8582658922275825e-16, 0.00014365342931976365, -1.7663277956043789e-12,
0.00011020196759483991, 7.2815566018121513e-17, -2.1954017992981933e-14,
0.0020657999619246329, 2.576049879034542e-13, 8.0868992676840926e-18,
-4.9871835120303166e-16, -0.00034053091053938995, -2.6793267144484798e-13,
-0.00044632572710929304, 1.4102025383294434e-16, -2.2312083497396612e-17,
-3.8253781993694921e-16, -2.3824101972097108e-13, -0.00014373695276279042,
-5.2674871449349439e-14, 8.0513134714064303e-17, -6.9434651930632667e-19,
-1.0397435424975874e-16, 8.2055194394566288e-17, -1.7663488301031992e-16,
-6.790876789747716e-17, 1.2887518678363419e-17, 0.00017088673166619592,
4.6178972501634574e-14, -0.00099698958013949698, 1.0736182831248829e-13,
-3.8128963770626898e-16, 1.4743894372675469e-17, -1.3280680806058713e-16,
-8.6576820505772252e-17, -0.00037807109106023103, -4.2502200225634281e-13,
0.00069457194093480647, 5.3780750336464426e-14, -1.4661228888741548e-18,
-4.4918812410044382e-17, -4.7072065657387135e-16, -3.9260616133880028e-17,
-5.2386688884514069e-17, 2.3392600778677079e-12, 0.00025654067145602645,
-8.7827166847214156e-17, 1.7638196580151998e-17, -5.409863306845453e-16,
1.4852376413657819e-16, -4.6147236936188859e-17, -1.1608613401683562e-15,
-2.707377014020053e-13, -0.00041555328360556848, 7.463095671524378e-13,
-1.3410019857064815e-16, 0.000332087290720808, -3.3563046400757839e-13,
-0.00092967904560811265, 1.097880619569886e-16, 6.9502513516651973e-17,
7.3044878657773531e-16, 0.00202254482354562, 3.0381959111195359e-15,
9.3916330211900847e-17, -2.823246701135113e-17, -6.1224075814261628e-16,
-1.6214598022477036e-05, -1.1733648839199915e-15, 0.00010119807020843918,
-1.3416982489893632e-17, 4.6980874226658593e-17, -2.6946344526466148e-17,
2.0698899289170575e-17, -1.2315742876245255e-16, 1.9634770620621417e-17,
2.3980922081152388e-16, -5.8219750030350244e-13, 0.00072506355690867062,
7.6833910644417825e-16, -9.3366979379536976e-06, -5.2917672168990202e-16,
-6.4252137616664386e-17, 4.7040984393660749e-18, 1.0448083544121011e-16,
-4.9268262836330645e-13, 0.0006169220940395717, -8.9691804344591304e-15,
-0.00022788510761296841, 4.6672495904392607e-17, -1.9292431488494769e-16,
-3.9255180835137428e-17, -3.1826995047386329e-17, 6.7488143811031927e-17,
0.00066123400136213688, 5.3020361573245661e-13, 0.00039407221009344045,
-6.534559354686395e-17, 1.2677153974434946e-16, -1.4149385786918615e-15,
5.3705554225475903e-17, -1.8247854037283063e-16, -1.0929843848358632e-15,
-0.00031674433652505624, 3.3622982322734505e-13, -5.4928125861283608e-05,
1.6929809294904542e-16, -2.5321574084469629e-13, -0.00041912727932904409,
-4.405155791690857e-14, 5.4904757114736033e-17, -1.1456919460929498e-15,
-4.7618682392339843e-05, -1.0517107033128787e-15, 0.000122213030941813,
2.2035612179965896e-16, -8.5287467504043407e-17, -1.1166934727456175e-15,
7.8197107602627665e-15, -0.00017634284716348627, 8.9778456741537705e-16,
2.4880023612507774e-17, -1.8873303398376193e-17, 6.9892077354297744e-17,
-1.6338341734553599e-16, -4.6690884277135488e-16, 9.0833639867518575e-17,
2.7567616892046996e-17, 8.2019142513652777e-05, 6.5646201519046165e-14,
0.00022344097201325758, -3.6103799994869289e-15, -1.1422993755978483e-15,
5.028978181670418e-17, -1.2630549880685089e-16, -2.690448651140072e-16,
8.0492854433554997e-05, 6.4918458703295526e-14, -0.00041407248433746394,
1.0272181368380898e-15, -5.1306530994526827e-17, -8.4810803055166527e-18,
-7.5343174853298523e-16, -3.8823180119589171e-17, 7.6731462972001117e-17,
-1.7176353972999986e-13, 0.00022112908393463521, 4.7267396189962653e-15,
0.0046103343298806347, -7.4416248987616007e-15, 0.001027014945950125,
-2.0098411324977195e-14, -3.6233053417589478e-15, 0.00034646554094179283,
-1.8886923817441892e-14, 2.6767273857538658e-17, -3.072701219454349e-17,
1.1009753941207472e-17, -1.6233271237647839e-14, -2.3155488975935429e-17,
-6.2527499673391034e-17, -1.1087008504419019e-17, 2.4638809229847293e-05,
1.968232163623157e-14, -8.1316331750450332e-18, 1.3523526557836501e-17,
8.3738336961521879e-17, -2.3931687053240846e-13, 0.00030672054173121942,
-1.6701619471107265e-14, 3.2676472803678084e-17, 9.6610837908798534e-17,
4.288170192048301e-17, 0.00045489485446747341, 3.6408328546436958e-13,
0.00012436871627476517, -2.3192249986800362e-14, -3.5532261337335898e-15,
0.00091627445322960805, 2.1996420465630206e-15, -2.7661309868174462e-17,
-6.2910677792136428e-18, -6.8353250961294113e-17, -1.9585037018747406e-17,
-2.2026841071595693e-14, 1.1107326115576255e-14, 0.00024984949962455929,
-1.6025881626199288e-15, 5.6596175680016302e-17, -8.2878803154274252e-18,
4.9098407580861438e-17, -6.0884189569387609e-18, -1.156837816604671e-14,
6.915773292578975e-15, -0.0057062073828032262, -9.8225445162427932e-16,
-0.00042758500277676972, 2.711090717082468e-17, 1.6621117742610494e-16,
1.5002900164004144e-17, -1.5929590142124814e-16, 0.0023852498178064366,
-5.5306074390332194e-14, 7.5682762330140296e-05, -1.3055958495312298e-13,
9.6710331918685747e-15, 0.0019928667082177833, -1.2477773805516512e-13,
-1.1723893698017626e-16, -1.6073957483468897e-16, -1.638107381184215e-16,
9.0084673932695064e-13, 2.0499980190211517e-18, -6.3935718003680363e-16,
-7.5094055838895037e-17, -0.0005909860946819919, -1.070069177038814e-12,
-1.2444457227367006e-17, 2.2642624108663221e-17, 5.8937843769245663e-16,
-1.4721634784633261e-12, 0.0018526779801249992, -1.3206710031132829e-13,
3.791257661260974e-17, -1.0381861336837133e-17, -7.8160440727697688e-17,
7.327340809524621e-05, 6.2520829349226492e-14, -0.00022364554106065623,
-1.0251612655564485e-14, -2.5926629888665433e-14, 0.00054843532399319014,
1.1289837985552144e-15, 4.5715582290917853e-17, -2.5414374803718e-17,
2.6908962407537464e-17, -1.3751359462141981e-17, -1.2073262040720317e-13,
-1.5186125062538816e-14, 0.0020471614271475435, -1.4092281008135598e-14,
-7.0595495259562984e-19, -5.6138302454437412e-17, -2.262466710468144e-17,
1.2051479066436289e-16, 8.9575999985276166e-15, -6.7831902746638695e-14,
0.00057521044427378534, -1.0069167687956539e-14, -0.00089821589927515917,
-8.1083328259225739e-17, 2.9140975038336277e-16, -8.0483070094853854e-18,
-1.8710318395836518e-16, -5.6661726904336587e-05, 0.0073039528187791771,
0.26524880605356216, -1.4948945672912245e-16, 0.23754853145615829,
0.0010352112131128926, -3.0455933592134568e-15, 0.23120074989356743,
-4.9572483270729107e-18, 8.6448493189620692e-17, -8.3748458824049103e-16,
0.22287543185248321, -5.2073303057620514e-16, -1.7090941154944217e-16,
1.7100932677735129e-16, -7.6538837608461233e-12, 0.23239547809785052,
-1.2179219026658899e-16, -5.6708002094769009e-17, 1.8106482115549727e-16,
-0.00029621414231670079, -2.6519145783005698e-13, 0.23316179598259826,
-1.3191214118858708e-15, -1.4693029178878867e-16, -4.7483206305090998e-16,
4.8112642342390544e-13, -0.00057739552579641311, -1.3817329984171234e-14,
0.21282012961721947, -0.010761820256327987, -6.6747127979880846e-16,
-0.0023714550505924198, 2.1550305323158324e-16, 9.880496170509447e-16,
8.8322869599175595e-17, 3.0376534354586293e-15, 0.24168571053561114,
0.0058927264585350546, -4.0075805358714273e-15, 0.003978375236235507,
-7.0152963476507372e-16, -1.5123321780444166e-15, -2.1282114372445949e-16,
-1.5293273339324898e-15, -0.0014362969678677318, 0.24384875239244713,
-8.6800683828103242e-15, -0.00057296636832987111, 1.5208984787719315e-15,
6.3666153733511202e-17, 1.6456362469476062e-16, -4.6135160019886215e-17,
7.1021140548755642e-17, 2.4507848007948585e-15, -2.1655420512356471e-14,
0.25123550612202733))

norb = 10
nelec = (5,5)
na = fci.cistring.num_strings(norb, nelec[0])
c0 = numpy.zeros((na,na))
c0[0,0] = 1
c0[-1,-1] = 1e-4
e0, ci0 = fci.direct_spin0.kernel(h1, h2, norb, nelec, ci0=c0)


class KnownValues(unittest.TestCase):
    def test_spin_squre(self):
        ss = fci.spin_op.spin_square(ci0, norb, nelec)
        self.assertAlmostEqual(ss[0], 6, 9)
        ss = fci.spin_op.spin_square0(ci0, norb, nelec)
        self.assertAlmostEqual(ss[0], 6, 9)

        numpy.random.seed(1)
        u,w,v = numpy.linalg.svd(numpy.random.random((norb,6)))
        u = u[:,:6]
        h1a = h1[:6,:6]
        h1b = reduce(numpy.dot, (v.T, h1a, v))
        h2aa = ao2mo.restore(1, h2, norb)[:6,:6,:6,:6]
        h2ab = lib.einsum('klpq,pi,qj->klij', h2aa, v, v)
        h2bb = lib.einsum('pqkl,pi,qj->ijkl', h2ab, v, v)
        e1, ci1 = fci.direct_uhf.kernel((h1a,h1b), (h2aa,h2ab,h2bb), 6, (3,2))
        ss = fci.spin_op.spin_square(ci1, 6, (3,2), mo_coeff=(numpy.eye(6),v))[0]
        self.assertAlmostEqual(ss, 3.75, 8)

    def test_contract_ss_high_cost(self):
        self.assertAlmostEqual(e0, -25.4538751043, 9)
        nelec = (6,4)
        na = fci.cistring.num_strings(norb, nelec[0])
        nb = fci.cistring.num_strings(norb, nelec[1])
        c0 = numpy.zeros((na,nb))
        c0[0,0] = 1
        bak0 = fci.direct_spin0.contract_2e
        bak1 = fci.direct_spin1.contract_2e
        fci.addons.fix_spin_(fci.direct_spin1)
        e, ci0 = fci.direct_spin1.kernel(h1, h2, norb, nelec, ci0=c0)
        self.assertAlmostEqual(e, -25.4437866823, 9)
        self.assertAlmostEqual(fci.spin_op.spin_square0(ci0, norb, nelec)[0], 2, 9)

        nelec = (5,5)
        fci.addons.fix_spin_(fci.direct_spin0)
        na = fci.cistring.num_strings(norb, nelec[0])
        c0 = numpy.zeros((na,na))
        c0[0,0] = 1
        e, ci0 = fci.direct_spin0.kernel(h1, h2, norb, nelec, ci0=c0)
        self.assertAlmostEqual(e, -25.4095560762, 7)
        self.assertAlmostEqual(fci.spin_op.spin_square0(ci0, norb, nelec)[0], 0, 7)
        fci.direct_spin0.contract_2e = bak0
        fci.direct_spin1.contract_2e = bak1


if __name__ == "__main__":
    print("Full Tests for fci.spin_op")
    unittest.main()




